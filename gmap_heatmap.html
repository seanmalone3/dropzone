<!DOCTYPE html>
<html>
  <head>
    <title>Styled Maps - Night Mode</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var pointarray, heatmap;
      var gradient, gradientStep = -1;

      var popularity = [
          {location: new google.maps.LatLng(35.778217, -78.644254),weight:0.2},
          {location: new google.maps.LatLng(35.776217, -78.645011),weight:0.5},
          {location: new google.maps.LatLng(35.777785, -78.639010),weight:0.8},
          {location: new google.maps.LatLng(35.780396, -78.646074),weight:0.5},
          {location: new google.maps.LatLng(35.793822, -78.688816),weight:0.5},
          {location: new google.maps.LatLng(35.786224, -78.661483),weight:1},
          {location: new google.maps.LatLng(35.786115, -78.647675),weight:1},
          {location: new google.maps.LatLng(35.775306, -78.638122),weight:0.4},
          {location: new google.maps.LatLng(35.777870, -78.634559),weight:1},
          {location: new google.maps.LatLng(35.777289, -78.636743),weight:0.7}
      ];


      function initMap() {
        // Styles a map in night mode.
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14,
          center: {
            lat: 35.781,lng: -78.645
          },
          styles: [
            {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
            {
              featureType: 'administrative.locality',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'geometry',
              stylers: [{color: '#263c3f'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'labels.text.fill',
              stylers: [{color: '#6b9a76'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry',
              stylers: [{color: '#38414e'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry.stroke',
              stylers: [{color: '#212a37'}]
            },
            {
              featureType: 'road',
              elementType: 'labels.text.fill',
              stylers: [{color: '#9ca5b3'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry',
              stylers: [{color: '#746855'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry.stroke',
              stylers: [{color: '#1f2835'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'labels.text.fill',
              stylers: [{color: '#f3d19c'}]
            },
            {
              featureType: 'transit',
              elementType: 'geometry',
              stylers: [{color: '#2f3948'}]
            },
            {
              featureType: 'transit.station',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'water',
              elementType: 'geometry',
              stylers: [{color: '#17263c'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.fill',
              stylers: [{color: '#515c6d'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.stroke',
              stylers: [{color: '#17263c'}]
            }
          ]
        });

    var pointArray = new google.maps.MVCArray(popularity);

    heatmap = new google.maps.visualization.HeatmapLayer({
        data: pointArray,
        radius: 20
    });

    heatmap.setMap(map);
    setGradient();

    google.maps.event.addListenerOnce(map, 'tilesloaded', modulateGradient);
	}

    function setGradient() {
        gradient = [
        'rgba(255, 0, 0, 0)',
        'rgba(255, 0, 0, 0.1)',
        'rgba(255, 0, 0, 0.2)',
        'rgba(255, 0, 0, 0.3)',
        'rgba(255, 0, 0, 0.4)',
        'rgba(255, 0, 0, 0.5)',
        'rgba(255, 0, 0, 0.6)',
        'rgba(255, 0, 0, 0.7)',
        'rgba(255, 0, 0, 0.8)',
        'rgba(255, 0, 0, 0.9)',
        'rgba(255, 0, 0, 1)'
        ];
        heatmap.set('gradient', gradient);
    }

    function modulateGradient() {
        var modulator = function() {
            var newGradient = gradient.slice(0, heatmap.get('gradient').length + gradientStep);

            if (newGradient.length == gradient.length || newGradient.length == 7) {
                gradientStep *= -1;
            }

            heatmap.set('gradient', newGradient);

            setTimeout(modulator, 100);
        };

        setTimeout(modulator, 100);
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkUOdZ5y7hMm0yrcCQoCvLwzdM6M8s5qk&libraries=visualization&callback=initMap"
    async defer></script>
  </body>
</html>
